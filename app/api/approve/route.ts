import { NextResponse } from 'next/server'; import { cookies } from 'next/headers'; import { createGmailDraft } from '@/lib/gmail'; import { createGraphDraft } from '@/lib/graph'; export async function POST(req:Request){ const { title, draft, provider='google' } = await req.json(); const c=cookies(); if(provider==='google'){ const a=c.get('google_access')?.value; if(!a) return NextResponse.json({ok:false,error:'not_connected_google'},{status:401}); try{ const r=await createGmailDraft(a, title||'Aurora Draft', draft||''); return NextResponse.json({ ok:true, provider:'google', id:r.id }); }catch(e:any){ return NextResponse.json({ ok:false, error:e?.message||'gmail_failed' }, {status:500}); } } if(provider==='microsoft'){ const a=c.get('ms_access')?.value; if(!a) return NextResponse.json({ok:false,error:'not_connected_ms'},{status:401}); try{ const r=await createGraphDraft(a, title||'Aurora Draft', draft||''); return NextResponse.json({ ok:true, provider:'microsoft', id:r.id }); }catch(e:any){ return NextResponse.json({ ok:false, error:e?.message||'graph_failed' }, {status:500}); } } return NextResponse.json({ ok:false, error:'unsupported_provider' }, {status:400}); }