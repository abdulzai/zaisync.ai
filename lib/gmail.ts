export async function createGmailDraft(accessToken:string, subject:string, body:string){ const mime=['Content-Type: text/plain; charset="UTF-8"','MIME-Version: 1.0',`Subject: ${subject}`,'',body||''].join('\n'); const raw=Buffer.from(mime).toString('base64url'); const r=await fetch('https://gmail.googleapis.com/gmail/v1/users/me/drafts',{ method:'POST', headers:{ Authorization:`Bearer ${accessToken}`, 'Content-Type':'application/json' }, body: JSON.stringify({ message:{ raw } }) }); if(!r.ok){ const t=await r.text(); throw new Error(`Gmail draft failed: ${r.status} ${t}`); } return r.json(); }